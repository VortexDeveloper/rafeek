<main class="content">
    <div class="dir">
        <div class="raf_item">
            <%= image_tag @package.avatar.url, class: 'package-img' %>
            <div class="raf_item_desc">
                <div class="caption rifa">
                  <% if !user_signed_in? %>
                    <div class="alert alert-info">
                      É necessário estar logado para comprar um pacote.
                    </div>
                  <% end %>
                  <h3><%= @package.name %></h3>
                  <p><%= @package.description %></p>

                  <%= form_tag package_transaction_purchase_path, method: :post, autocomplete: :on, class: 'form-package' do %>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                          <%= label_tag :amount, "Quantidade", class: 'form-package' %>
                          <%= number_field_tag :amount, 1, class: 'form-control form-package', placeholder: "Qtd" %>
                      </div>
                      <div class="form-group">
                          <%= label_tag :cartao_numero, "Número do cartão", class: 'form-package' %>
                          <%= text_field_tag :cartao_numero, nil, class:'form-control form-package' %>
                      </div>
                      <div class="form-group">
                          <%= label_tag :cartao_validade, "Validade do cartão", class: 'form-package' %>
                          <%= text_field_tag :cartao_validade, nil, class:'form-control form-package' %>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                          <%= label_tag :cartao_seguranca, "Código de segurança do cartão", class: 'form-package' %>
                          <%= text_field_tag :cartao_seguranca, nil, class:'form-control form-package' %>
                      </div>
                      <div class="form-group">
                          <%= label_tag :cartao_portador, "Nome do portador do cartão", class: 'form-package' %>
                          <%= text_field_tag :cartao_portador, nil, class:'form-control form-package' %>
                      </div>
                      <div class="form-group">
                          <%= label_tag :bandeira, "Bandeira do cartão", class: 'form-package' %>
                          <%= select_tag :bandeira, bandeira_for_select, include_blank: true, class: 'form-control form-package'%>
                      </div>
                    </div>
                    </div>

                    <div class="alert alert-info super-alert" role="alert">
                      <h3>CONTA SUPER</h3>
                      <p>Não possui cartão de crédito? Não se preocupe, existe uma alternativa para você.
                        Utilize o cartão de crédito pré pago da Conta Super, é fácil faça seu cadastro e carregue seu cartão com dinheiro.
                        Pronto agora você também já pode comprar nossos pacotes de pontos.
                        Divirta-se. <%= link_to 'www.contasuper.com.br', 'http://www.contasuper.com.br/', target: '_blank' %></p>
                    </div>

                    <table class="table">
                        <tbody>
                            <tr>
                                <td><p>Valor unitário</p></td>
                                <td>
                                    <p data-value='<%= @package.value %>' id="unidade">
                                      <%= @package.value %>
                                    </p>
                                </td>
                            </tr>
                            <tr>
                                <td><p>Valor Total</p></td>
                                <td>
                                  <p id="total">

                                  </p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <%= hidden_field_tag :package_id, @package.id %>

                    <% if user_signed_in? %>
                      <p>
                        <%= submit_tag 'Comprar pontos', class: 'btn btn-primary raf_item_desc pontos'  %>
                      </p>
                    <% else %>
                      <p>
                        <%= button_tag 'Login',
                          class: 'btn news_button login-btn',
                          :'data-toggle' => "modal",
                          :'data-target' => "#login-modal"
                        %>
                      </p>
                    <% end %>
                  <% end %>
                </div>
            </div>
        </div>
    </div>
</main>
login-modal
<script type="text/javascript">
  accounting.settings = {
  	currency: {
  		symbol : "R$",   // default currency symbol is '$'
  		format: "%s %v", // controls output: %s = symbol, %v = value/number (can be object: see below)
  		decimal : ",",  // decimal point separator
  		thousand: ".",  // thousands separator
  		precision : 2   // decimal places
  	},
  	number: {
  		precision : 0,  // default precision on numbers is 0
  		thousand: ",",
  		decimal : "."
  	}
  }
  $("#unidade").text(accounting.formatMoney($("#unidade").attr('data-value')));
  $("#total").text(accounting.formatMoney(unidade * amount));

  $("#amount").on('change', function () {
      var amount = $("#amount").val();
      var unidade = $("#unidade").attr('data-value');
      $("#total").text(accounting.formatMoney(unidade * amount));
  });

  $('#cartao_numero').payment('formatCardNumber');
  $('#cartao_seguranca').payment('formatCardCVC');
  $('#cartao_validade').payment('formatCardExpiry');

  var migo = $;
  var cardType = null;

  $('.form-package').on('change','#cartao_numero', function(){
    cardType = migo.payment.cardType($('#cartao_numero').val());
    $('#bandeira').val(cardType);

    if (migo.payment.validateCardNumber($('#cartao_numero').val())) {
      $('#cartao_numero').parent().addClass('has-success');
      $('#cartao_numero').parent().removeClass('has-error');
    } else {
      $('#cartao_numero').parent().removeClass('has-success');
      $('#cartao_numero').parent().addClass('has-error');
    }
  });

  $('.form-package').on('change', '#cartao_validade', function(){
    if (migo.payment.validateCardExpiry($('#cartao_validade').payment('cardExpiryVal'))) {
      $('#cartao_validade').parent().addClass('has-success');
      $('#cartao_validade').parent().removeClass('has-error');
    } else {
      $('#cartao_validade').parent().removeClass('has-success');
      $('#cartao_validade').parent().addClass('has-error');
    }
  });

  $('.form-package').on('change','#cartao_seguranca', function(){
    if (migo.payment.validateCardCVC($('#cartao_seguranca').val(), cardType)) {
      $('#cartao_seguranca').parent().addClass('has-success');
      $('#cartao_seguranca').parent().removeClass('has-error');
    } else {
      $('#cartao_seguranca').parent().removeClass('has-success');
      $('#cartao_seguranca').parent().addClass('has-error');
    }
  });
</script>
